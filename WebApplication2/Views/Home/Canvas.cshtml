
@{
    ViewBag.Title = "Canvas";
}


<div class="container-fluid fill img-rounded">


    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10 personal-info">
            <h1>Canvas</h1>
            <hr>
            <div class="literally"></div>
        </div>


        <div class="col-md-1"></div>
    </div>
</div>

    <!-- stylesheet -->



    <!-- where the widget goes. you can do CSS to it. -->

    <!-- kick it off -->



@section scripts{
<script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="~/signalr/hubs"></script>

<link href="~/Theme/Canvas/css/literallycanvas.css" rel="stylesheet">
<script src="~/Theme/Canvas/js/react-with-addons.js"></script>
<!-- dependency: React.js -->

<!-- Literally Canvas -->
<script src="~/Theme/Canvas/js/literallycanvas.js"></script>
    
    <script>

        
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
        };

        var username = getUrlParameter('username');

        $(document).ready(function () {

           

                // Look ma, no jQuery!
                var lc=LC.init(
                    document.getElementsByClassName('literally')[0],
                    { imageURLPrefix: '/Theme/Canvas/static/img' });


	        //       var localStorageKey = 'drawing'
            //if (localStorage.getItem(localStorageKey)) {
            //  lc.loadSnapshot(JSON.parse(localStorage.getItem(localStorageKey)));
            //}

           var disableit= lc.on('drawingChange', function() {
             // localStorage.setItem(localStorageKey, JSON.stringify(lc.getSnapshot()));
                 chats.server.sendChatMessage(username, JSON.stringify(lc.getSnapshot()));
              //  alert(1);
            });

      
        var chats = $.connection.canvas;
        chats.client.addChatMessage = function (message) {
            disableit();
            lc.loadSnapshot(JSON.parse(message));
            disableit = lc.on('drawingChange', function () {
                // localStorage.setItem(localStorageKey, JSON.stringify(lc.getSnapshot()));
                chats.server.sendChatMessage(username, JSON.stringify(lc.getSnapshot()));
                //  alert(1);
            });

        };

        $.connection.hub.start().done(function () {

            chats.server.sendChatMessage(username, "value");

        });




        });

        /* or if you just love jQuery,
            $('.literally').literallycanvas({imageURLPrefix: '/static/img'})
            or
            LC.init($('.literally').get(0), {imageURLPrefix: '/static/img'})
        */
    </script>

    }